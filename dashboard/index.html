<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®çœ‹æ¿ - å¸‚åœºæŠ¥å‘Š & OpenVikingè®°å¿†ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .card-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #667eea;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .chart-container {
            height: 300px;
            margin: 20px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        .recent-list {
            list-style: none;
            padding: 0;
        }
        .recent-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .recent-item:last-child {
            border-bottom: none;
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .back-link:hover {
            background: #5a6fd8;
        }
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š æ•°æ®çœ‹æ¿</h1>
            <p>å¸‚åœºæŠ¥å‘Šæ•°æ® & OpenVikingè®°å¿†ç³»ç»Ÿç»Ÿè®¡</p>
        </div>

        <!-- å¸‚åœºæŠ¥å‘Šæ•°æ®çœ‹æ¿ -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h2 class="card-title">ğŸ“ˆ å¸‚åœºæŠ¥å‘Šç»¼åˆè¯„åˆ†è¶‹åŠ¿</h2>
                <div class="chart-container">
                    <canvas id="scoreTrendChart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <h2 class="card-title">ğŸ“Š ç»´åº¦åˆ†æ•°å¯¹æ¯”</h2>
                <div class="chart-container">
                    <canvas id="dimensionScoresChart"></canvas>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h2 class="card-title">ğŸ” å…³é”®æŒ‡æ ‡ç›‘æ§</h2>
                <div id="metricsList">
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>

            <div class="dashboard-card">
                <h2 class="card-title">ğŸ¤– AI Tokenæ¶ˆè€—è¶‹åŠ¿</h2>
                <div id="aiTokenData">
                    <p>åŠ è½½ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- OpenVikingè®°å¿†ç³»ç»Ÿçœ‹æ¿ -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h2 class="card-title">ğŸ§  OpenVikingè®°å¿†ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalMemories">-</div>
                        <div class="stat-label">æ€»è®°å¿†æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="categoryCount">-</div>
                        <div class="stat-label">åˆ†ç±»æ•°é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="priorityHigh">-</div>
                        <div class="stat-label">é«˜ä¼˜å…ˆçº§</div>
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <h2 class="card-title">ğŸ“ˆ è®°å¿†åˆ›å»ºè¶‹åŠ¿</h2>
                <div class="chart-container">
                    <canvas id="memoryTrendChart"></canvas>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <h2 class="card-title">ğŸ“ æœ€è¿‘è®°å¿†</h2>
                <ul class="recent-list" id="recentMemories">
                    <li>åŠ è½½ä¸­...</li>
                </ul>
            </div>

            <div class="dashboard-card">
                <h2 class="card-title">ğŸ“Š åˆ†ç±»ç»Ÿè®¡</h2>
                <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>

        <a href="../index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    </div>

    <script>
        // ä»data.jsonåŠ è½½æ•°æ®
        async function loadData() {
            try {
                const response = await fetch('data.json');
                const data = await response.json();
                
                // æ¸²æŸ“æ‰€æœ‰å›¾è¡¨å’Œæ•°æ®
                renderScoreTrendChart(data.market_report.reports);
                renderDimensionScoresChart(data.market_report.dimensions);
                renderMetricsList(data.market_report.metrics);
                renderAITokenData(data.market_report.ai_data);
                renderMemoryStats(data.viking_memory);
                renderMemoryTrendChart(data.viking_memory.recent_activity);
                renderRecentMemories(data.viking_memory.recent_memories);
                renderCategoryChart(data.viking_memory.category_stats);
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                document.body.innerHTML = '<div style="text-align: center; padding: 50px; color: red;">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚</div>';
            }
        }

        // æ¸²æŸ“ç»¼åˆè¯„åˆ†è¶‹åŠ¿å›¾
        function renderScoreTrendChart(reports) {
            const ctx = document.getElementById('scoreTrendChart').getContext('2d');
            const dates = reports.map(r => r.date).reverse();
            const scores = reports.map(r => r.score).reverse();
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'ç»¼åˆè¯„åˆ†',
                        data: scores,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“ç»´åº¦åˆ†æ•°å¯¹æ¯”å›¾
        function renderDimensionScoresChart(dimensions) {
            const ctx = document.getElementById('dimensionScoresChart').getContext('2d');
            const names = dimensions.map(d => d.name);
            const scores = dimensions.map(d => d.score);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: names,
                    datasets: [{
                        label: 'ç»´åº¦åˆ†æ•°',
                        data: scores,
                        backgroundColor: '#764ba2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            min: 0,
                            max: 100
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“å…³é”®æŒ‡æ ‡åˆ—è¡¨
        function renderMetricsList(metrics) {
            const container = document.getElementById('metricsList');
            if (metrics.length === 0) {
                container.innerHTML = '<p>æš‚æ— æ•°æ®</p>';
                return;
            }
            
            let html = '<ul>';
            metrics.forEach(metric => {
                const statusColor = metric.status === 'å·²éªŒè¯' ? '#4CAF50' : '#FF9800';
                html += `
                    <li style="margin: 10px 0; padding: 5px; border-left: 4px solid ${statusColor};">
                        <strong>${metric.name}:</strong> ${metric.value}
                        <span style="color: ${statusColor}; font-size: 0.9em;">(${metric.status})</span>
                    </li>
                `;
            });
            html += '</ul>';
            container.innerHTML = html;
        }

        // æ¸²æŸ“AI Tokenæ•°æ®
        function renderAITokenData(aiData) {
            const container = document.getElementById('aiTokenData');
            if (!aiData.monthly_tokens) {
                container.innerHTML = '<p>æš‚æ— AI Tokenæ•°æ®</p>';
                return;
            }
            
            container.innerHTML = `
                <p><strong>æœˆåº¦æ€»æ¶ˆè€—:</strong> ${aiData.monthly_tokens}T tokens</p>
                <p><strong>MOMå¢é•¿ç‡:</strong> ${aiData.mom_growth}%</p>
                <p style="font-size: 0.9em; color: #666;">
                    æ•°æ®æ¥æº: OpenRouterå¹³å°ï¼ˆè¶‹åŠ¿æŒ‡æ ‡ï¼‰
                </p>
            `;
        }

        // æ¸²æŸ“è®°å¿†ç»Ÿè®¡
        function renderMemoryStats(memoryData) {
            document.getElementById('totalMemories').textContent = memoryData.total_memories;
            document.getElementById('categoryCount').textContent = memoryData.category_stats.length;
            
            // è®¡ç®—é«˜ä¼˜å…ˆçº§è®°å¿†æ•°é‡
            const highPriority = memoryData.priority_stats.find(p => p.priority === 1) || {count: 0};
            document.getElementById('priorityHigh').textContent = highPriority.count;
        }

        // æ¸²æŸ“è®°å¿†è¶‹åŠ¿å›¾
        function renderMemoryTrendChart(activity) {
            const ctx = document.getElementById('memoryTrendChart').getContext('2d');
            const dates = activity.map(a => a.date);
            const counts = activity.map(a => a.count);
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'æ¯æ—¥è®°å¿†åˆ›å»ºæ•°',
                        data: counts,
                        borderColor: '#4CAF50',
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // æ¸²æŸ“æœ€è¿‘è®°å¿†åˆ—è¡¨
        function renderRecentMemories(memories) {
            const container = document.getElementById('recentMemories');
            if (memories.length === 0) {
                container.innerHTML = '<li>æš‚æ— è®°å¿†</li>';
                return;
            }
            
            let html = '';
            memories.forEach(memory => {
                html += `
                    <li class="recent-item">
                        <strong>${memory.title}</strong><br>
                        <span style="font-size: 0.9em; color: #666;">
                            åˆ†ç±»: ${memory.category} | ${new Date(memory.created_at).toLocaleDateString()}
                        </span>
                    </li>
                `;
            });
            container.innerHTML = html;
        }

        // æ¸²æŸ“åˆ†ç±»ç»Ÿè®¡å›¾
        function renderCategoryChart(categories) {
            const ctx = document.getElementById('categoryChart').getContext('2d');
            const labels = categories.map(c => c.category);
            const data = categories.map(c => c.count);
            
            // ç”Ÿæˆéšæœºé¢œè‰²
            const colors = labels.map((_, i) => 
                `hsl(${i * 360 / labels.length}, 70%, 60%)`
            );
            
            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });
    </script>
</body>
</html>